# Nopher Configuration Example
# For full documentation, see: memory/configuration.md

site:
  title: "My Notes"
  description: "Personal Nostr gopherhole"
  operator: "Alice"

identity:
  # Your Nostr public key (required)
  npub: "npub1..."
  # IMPORTANT: Never put nsec in this file!
  # Set via environment variable: NOPHER_NSEC=nsec1...

protocols:
  gopher:
    enabled: true
    host: "gopher.example.com"
    port: 70
    bind: "0.0.0.0"

  gemini:
    enabled: true
    host: "gemini.example.com"
    port: 1965
    bind: "0.0.0.0"
    tls:
      cert_path: "./certs/cert.pem"
      key_path: "./certs/key.pem"
      auto_generate: true  # Generate self-signed cert if not found

  finger:
    enabled: true
    port: 79
    bind: "0.0.0.0"
    max_users: 100  # Limit finger queries to owner + top N followed

relays:
  seeds:
    - "wss://relay.damus.io"
    - "wss://relay.nostr.band"
    - "wss://nos.lol"
  policy:
    connect_timeout_ms: 5000
    max_concurrent_subs: 8
    backoff_ms: [500, 1500, 5000]

discovery:
  refresh_seconds: 900  # How often to refresh kind 10002 (NIP-65)
  use_owner_hints: true  # Use owner's 10002 for owner data
  use_author_hints: true  # Use authors' 10002 for their data
  fallback_to_seeds: true  # When hints are missing/stale
  max_relays_per_author: 8  # Safety cap

sync:
  kinds: [0, 1, 3, 6, 7, 9735, 30023, 10002]
  scope:
    mode: "foaf"  # self|following|mutual|foaf
    depth: 2  # used when mode=foaf
    include_direct_mentions: true
    include_threads_of_mine: true
    max_authors: 5000
    allowlist_pubkeys: []
    denylist_pubkeys: []
  retention:
    keep_days: 365
    prune_on_start: true

inbox:
  include_replies: true
  include_reactions: true  # kind 7
  include_zaps: true  # kind 9735
  group_by_thread: true
  collapse_reposts: true
  noise_filters:
    min_zap_sats: 1
    allowed_reaction_chars: ["+"]

outbox:
  publish:
    notes: true
    reactions: false
    zaps: false
  draft_dir: "./content"
  auto_sign: false

storage:
  driver: "sqlite"  # sqlite|lmdb (via Khatru eventstore)
  sqlite_path: "./data/nopher.db"
  lmdb_path: "./data/nopher.lmdb"  # if driver=lmdb
  lmdb_max_size_mb: 10240  # max DB size for LMDB (10GB default)

rendering:
  gopher:
    max_line_length: 70  # wrap text for gopher clients
    show_timestamps: true
    date_format: "2006-01-02 15:04 MST"
    thread_indent: "  "
  gemini:
    max_line_length: 80
    show_timestamps: true
    emoji: true  # allow emoji in gemtext
  finger:
    plan_source: "kind_0"  # use kind 0 (profile) about field as .plan
    recent_notes_count: 5  # show last N notes in finger response

caching:
  enabled: true  # master switch
  engine: "memory"  # memory|redis
  redis_url: ""  # via env if engine=redis
  ttl:
    sections:
      notes: 60  # seconds
      comments: 30
      articles: 300
      interactions: 10
    render:
      gopher_menu: 300  # cache gophermap generation
      gemini_page: 300  # cache gemtext rendering
      finger_response: 60  # cache finger queries
      kind_1: 86400  # 24h
      kind_30023: 604800  # 7d
      kind_0: 3600  # 1h
      kind_3: 600  # 10m
  aggregates:
    enabled: true
    update_on_ingest: true
    reconciler_interval_seconds: 900

logging:
  level: "info"  # debug|info|warn|error

layout:
  # See memory/layouts_sections.md for full spec
  sections: {}
  pages: {}
