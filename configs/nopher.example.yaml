# Nopher Configuration Example
# For full documentation, see: memory/configuration.md

site:
  title: "My Notes"
  description: "Personal Nostr gopherhole"
  operator: "Alice"

identity:
  # Your Nostr public key (required)
  npub: "npub1..."
  # IMPORTANT: Never put nsec in this file!
  # Set via environment variable: NOPHER_NSEC=nsec1...

protocols:
  gopher:
    enabled: true
    host: "gopher.example.com"
    port: 70
    bind: "0.0.0.0"

  gemini:
    enabled: true
    host: "gemini.example.com"
    port: 1965
    bind: "0.0.0.0"
    tls:
      cert_path: "./certs/cert.pem"
      key_path: "./certs/key.pem"
      auto_generate: true  # Generate self-signed cert if not found

  finger:
    enabled: true
    port: 79
    bind: "0.0.0.0"
    max_users: 100  # Limit finger queries to owner + top N followed

relays:
  seeds:
    - "wss://relay.damus.io"
    - "wss://relay.nostr.band"
    - "wss://nos.lol"
  policy:
    connect_timeout_ms: 5000
    max_concurrent_subs: 8
    backoff_ms: [500, 1500, 5000]

discovery:
  refresh_seconds: 900  # How often to refresh kind 10002 (NIP-65)
  use_owner_hints: true  # Use owner's 10002 for owner data
  use_author_hints: true  # Use authors' 10002 for their data
  fallback_to_seeds: true  # When hints are missing/stale
  max_relays_per_author: 8  # Safety cap

sync:
  # Granular control over which event kinds to sync
  kinds:
    profiles: true      # kind 0 - user profiles/metadata
    notes: true         # kind 1 - short text notes
    contact_list: true  # kind 3 - following lists
    reposts: true       # kind 6 - reposts/boosts
    reactions: true     # kind 7 - reactions (likes, emoji)
    zaps: true          # kind 9735 - lightning zaps
    articles: true      # kind 30023 - long-form articles
    relay_list: true    # kind 10002 - relay preferences (NIP-65)
    allowlist: []       # Additional custom kinds to sync
  scope:
    mode: "foaf"  # self|following|mutual|foaf
    depth: 2  # used when mode=foaf
    include_direct_mentions: true
    include_threads_of_mine: true
    max_authors: 5000
    allowlist_pubkeys: []
    denylist_pubkeys: []
  retention:
    keep_days: 365
    prune_on_start: true

inbox:
  include_replies: true
  include_reactions: true  # kind 7
  include_zaps: true  # kind 9735
  group_by_thread: true
  collapse_reposts: true
  noise_filters:
    min_zap_sats: 1
    allowed_reaction_chars: ["+"]

outbox:
  publish:
    notes: true
    reactions: false
    zaps: false
  draft_dir: "./content"
  auto_sign: false

storage:
  driver: "sqlite"  # sqlite|lmdb (via Khatru eventstore)
  sqlite_path: "./data/nopher.db"
  lmdb_path: "./data/nopher.lmdb"  # if driver=lmdb
  lmdb_max_size_mb: 10240  # max DB size for LMDB (10GB default)

rendering:
  gopher:
    max_line_length: 70  # wrap text for gopher clients
    show_timestamps: true
    date_format: "2006-01-02 15:04 MST"
    thread_indent: "  "
  gemini:
    max_line_length: 80
    show_timestamps: true
    emoji: true  # allow emoji in gemtext
  finger:
    plan_source: "kind_0"  # use kind 0 (profile) about field as .plan
    recent_notes_count: 5  # show last N notes in finger response

caching:
  enabled: true  # master switch
  engine: "memory"  # memory|redis
  redis_url: ""  # via env if engine=redis
  ttl:
    sections:
      notes: 60  # seconds
      comments: 30
      articles: 300
      interactions: 10
    render:
      gopher_menu: 300  # cache gophermap generation
      gemini_page: 300  # cache gemtext rendering
      finger_response: 60  # cache finger queries
      kind_1: 86400  # 24h
      kind_30023: 604800  # 7d
      kind_0: 3600  # 1h
      kind_3: 600  # 10m
  aggregates:
    enabled: true
    update_on_ingest: true
    reconciler_interval_seconds: 900

logging:
  level: "info"  # debug|info|warn|error
  format: "text"  # text|json

layout:
  # See memory/layouts_sections.md for full spec
  sections: {}
  pages: {}

# ============================================================================
# PHASE 18: Display Customization and Content Control
# ============================================================================

display:
  # Controls what information is shown in feed/list views vs detail views
  feed:
    show_interactions: true  # Show aggregate stats (replies, reactions, zaps)
    show_reactions: true     # Include reaction counts in aggregates
    show_zaps: true          # Include zap amounts in aggregates
    show_replies: true       # Include reply counts in aggregates

  detail:
    show_interactions: true  # Show aggregate stats on individual note pages
    show_reactions: true     # Include reaction breakdown
    show_zaps: true          # Include zap total
    show_replies: true       # Include reply count
    show_thread: true        # Show thread context/replies

  limits:
    summary_length: 100         # Characters to show in list previews
    max_content_length: 5000    # Maximum content length before truncation
    max_thread_depth: 10        # Maximum depth for thread display
    max_replies_in_feed: 3      # Max replies to show in feed items
    truncate_indicator: "..."   # String to append when content is truncated

presentation:
  # Visual presentation and layout customization
  headers:
    global:
      enabled: false
      content: ""              # Inline header text
      file_path: ""            # Or load from file (e.g., "./headers/global.txt")
    per_page: {}               # Page-specific headers, e.g.:
      # notes:
      #   enabled: true
      #   content: "My Notes Collection"

  footers:
    global:
      enabled: false
      content: ""              # Inline footer text
      file_path: ""            # Or load from file (e.g., "./footers/global.txt")
    per_page: {}               # Page-specific footers

  separators:
    # Protocol-specific separators between items and sections
    item:
      gopher: ""               # Empty = no separator between list items
      gemini: ""
      finger: ""
    section:
      gopher: "---"            # Default: 70 dashes
      gemini: "---"            # Separator between major sections
      finger: "---"

behavior:
  # Query behavior and content filtering
  content_filtering:
    enabled: false             # Master switch for content filtering
    min_reactions: 0           # Minimum reactions to display note
    min_zap_sats: 0            # Minimum sats zapped to display note
    min_engagement: 0          # Minimum combined engagement score
    hide_no_interactions: false # Hide notes with no interactions at all
    allowed_content_types: []  # Future: filter by content type

  sort_preferences:
    # Sort mode for each section: chronological|engagement|zaps|reactions
    notes: "chronological"     # How to sort notes list
    articles: "chronological"  # How to sort articles list
    replies: "chronological"   # How to sort replies list
    mentions: "chronological"  # How to sort mentions list

  pagination:
    enabled: false             # Enable pagination (future feature)
    items_per_page: 50         # Items per page when enabled
    max_pages: 10              # Maximum pages to generate

# Sections - Custom filtered views (optional)
# Sections allow you to create custom filtered content views at any path
# Multiple sections can share the same path (e.g., homepage with multiple topic previews)
#sections:
#  # Example: DIY preview on homepage (5 items)
#  - name: diy-preview
#    path: /                    # Override homepage
#    title: Recent DIY Projects
#    order: 1                   # Display order (lower first)
#    filters:
#      tags:
#        t: [diy]              # Filter by #t tag
#    limit: 5                  # Show 5 items
#    show_dates: true
#    show_authors: true
#    more_link:
#      text: More DIY posts
#      section_ref: diy-full   # Link to full section
#
#  # Example: Philosophy preview on homepage (3 items)
#  - name: philosophy-preview
#    path: /
#    title: Recent Philosophy
#    order: 2
#    filters:
#      tags:
#        t: [philosophy]
#    limit: 3
#    show_dates: true
#    more_link:
#      text: More philosophy
#      section_ref: philosophy-full
#
#  # Example: Full DIY section at /diy (paginated)
#  - name: diy-full
#    path: /diy
#    title: All DIY Projects
#    filters:
#      tags:
#        t: [diy]
#    limit: 9                  # Gopher pagination limit
#    show_dates: true
#    show_authors: true
#    sort_by: created_at
#    sort_order: desc
#
#  # Example: Full philosophy section
#  - name: philosophy-full
#    path: /philosophy
#    title: All Philosophy Posts
#    filters:
#      tags:
#        t: [philosophy]
#    limit: 9
#    show_dates: true

# Template variables for headers/footers:
# {{site.title}}       - Site title from site.title
# {{site.description}} - Site description
# {{site.operator}}    - Operator name
# {{date}}             - Current date (YYYY-MM-DD)
# {{datetime}}         - Current date and time
# {{year}}             - Current year
