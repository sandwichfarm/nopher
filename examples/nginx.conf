# Nginx reverse proxy configuration for Nopher
# This handles TLS termination for Gemini protocol

# Gemini protocol (port 1965 with TLS)
stream {
    upstream gemini_backend {
        server localhost:1965;
    }

    server {
        listen 1965 ssl;
        
        ssl_certificate /etc/ssl/certs/nopher.crt;
        ssl_certificate_key /etc/ssl/private/nopher.key;
        ssl_protocols TLSv1.2 TLSv1.3;
        ssl_ciphers HIGH:!aNULL:!MD5;
        
        proxy_pass gemini_backend;
        proxy_ssl off;
    }
}

# Optional: HTTP endpoint for monitoring/health checks
http {
    server {
        listen 8080;
        server_name _;

        location /health {
            access_log off;
            return 200 "OK\n";
            add_header Content-Type text/plain;
        }

        location / {
            return 404;
        }
    }
}

# Note: Gopher (port 70) and Finger (port 79) typically run without TLS
# If you need to proxy them, use stream blocks similar to Gemini above
